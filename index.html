
<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta charset="utf-8">
	<title>Relentless Constant</title>

	<meta name="author" content="Jonathan Meyers">
	
	<meta name="description" content="21 May 2015 Scrubbing Video on Scroll During a recent visit to Apple's website, I noticed an amazing animation on their Macbook product page. As I &hellip;">

	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link href="/atom.xml" rel="alternate" title="Relentless Constant" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/.min.css" />
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body class="home-template">
  <header id="site-head">
  <div class="vertical">
    <div id="site-head-content" class="inner">
      <h1 class="blog-title"><a class="no-rollover" href="/">Relentless Constant</a></h1>
      <h2 class="blog-description">Deep dives in the ocean of code</h2>
    </div>
  </div>
</header>
  <main class="content" role="main">
    



  
    <article class="post">
      
	
		
	
	<header class="post-header">
		<span class="post-meta">21 May 2015</span>
		<h2 class="post-title">
			
			<a href="/blog/2015/05/21/scrubbing-video-on-scroll/">
			
				Scrubbing Video on Scroll</a>
		</h2>
	</header>
	<section class="post-excerpt">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>


<p><br></p>

<div id="vid-container" style="overflow-y: scroll; height:400px;">
  <div id="vid-container-2" style="height:800px;position;relative">
    <video id="v0" style="position: absolute;left: 0;width: 100%;" tabindex="0" >
      <source type="video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;" src=""></source> 
    </video>
  </div>
</div>


<p></p>

<p>During a recent visit to Apple&#8217;s website, I noticed an amazing animation on their Macbook product page. As I scrolled down to learn more about their new Macbook, the computer opened and changed its orientation based on my scroll. I thought it was so cool, I decided to figure out how it worked. As I dug through the site with Chrome developer tools I realized that the &#8216;animation&#8217; was simply a very well produced video. I figured out that my scroll was simply controlling where the playhead position was in this video. Simple enough. Now to build my own.</p>




<p>Creating a scrollable video can be broken down into three parts:<ol><li>Capturing a value set the playhead equal to</li><li>Setting the playhead to that value</li><li>Repeating this code at a very fast time interval to create the illusion of smooth video playback</li></ol>Below you can see the html that creates the flower video above.</p>


<!-- HTML generated using hilite.me -->


<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f92672">&lt;div</span> <span style="color: #a6e22e">id=</span><span style="color: #e6db74">&quot;vid-container&quot;</span> <span style="color: #a6e22e">style=</span><span style="color: #e6db74">&quot;overflow-y: scroll; height:400px;&quot;</span><span style="color: #f92672">&gt;</span>
  <span style="color: #f92672">&lt;div</span> <span style="color: #a6e22e">id=</span><span style="color: #e6db74">&quot;vid-container-2&quot;</span> <span style="color: #a6e22e">style=</span><span style="color: #e6db74">&quot;height:800px;position;relative&quot;</span><span style="color: #f92672">&gt;</span>
    <span style="color: #f92672">&lt;video</span> <span style="color: #a6e22e">id=</span><span style="color: #e6db74">&quot;v0&quot;</span> <span style="color: #a6e22e">style=</span><span style="color: #e6db74">&quot;position: absolute;left: 0;width: 100%;&quot;</span> <span style="color: #a6e22e">tabindex=</span><span style="color: #e6db74">&quot;0&quot;</span> <span style="color: #a6e22e">autobuffer=</span><span style="color: #e6db74">&quot;autobuffer&quot;</span> <span style="color: #a6e22e">preload=</span><span style="color: #e6db74">&quot;preload&quot;</span><span style="color: #f92672">&gt;</span>
      <span style="color: #f92672">&lt;source</span> <span style="color: #a6e22e">type=</span><span style="color: #e6db74">&quot;video/mp4; codecs=&amp;quot;avc1.42E01E, mp4a.40.2&amp;quot;&quot;</span> <span style="color: #a6e22e">src=</span><span style="color: #e6db74">&quot;/images/flower-slow-bloom-4k.mp4&quot;</span><span style="color: #f92672">&gt;&lt;/source&gt;</span>
    <span style="color: #f92672">&lt;/video&gt;</span>
  <span style="color: #f92672">&lt;/div&gt;</span>
<span style="color: #f92672">&lt;/div&gt;</span>  
</pre></div>




<p>The code creates a small div, which should be just large enough to fit the dimensions of the video. By using &#8216;overflow-y: scroll;&#8217;, any contents included in this div, that are larger than the height of the div, can now be scrolled. So to take advantage of this, I create a taller div inside of my original div. Finally, I include the video and source inside of this div with absolute positioning so it will no move as the content inside the div is scrolled. In order to make this video work in the context of my blog page, I used a lot of inline styling to preserve the integrity of my blog css file. I would reccomend moving all this styling to a sepearte css file if you would plan on creating a scrollable video on your own site.</p>




<p>Below is the javascript that makes the video come alive!</p>


<!-- HTML generated using hilite.me -->


<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">document</span> <span style="color: #f8f8f2">).</span><span style="color: #a6e22e">ready</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span> <span style="color: #e6db74">&quot;ready!&quot;</span> <span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>

<span style="color: #75715e">// select video element</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">vid</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">document.</span><span style="color: #a6e22e">getElementById</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;v0&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #75715e">// pause video on load</span>
<span style="color: #a6e22e">vid</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">pause</span><span style="color: #f8f8f2">();</span>
 
<span style="color: #75715e">// pause video on document scroll (stops autoplay once scroll started)</span>
<span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;#vid-container&#39;</span><span style="color: #f8f8f2">).</span><span style="color: #a6e22e">onscroll</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
    <span style="color: #a6e22e">vid</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">pause</span><span style="color: #f8f8f2">();</span>
<span style="color: #f8f8f2">};</span>

<span style="color: #75715e">// refresh video frames on interval for smoother playback</span>
<span style="color: #75715e">// dividing the totalTime scrubTime calculation by 25 determines </span>
<span style="color: #75715e">// how many frames will be covered in the span of a &#39;normal&#39; scroll</span>
<span style="color: #75715e">// the lower the number, the more frames will be covered in a scroll</span>
<span style="color: #a6e22e">setInterval</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">totalTime</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">290</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">scrubTimeSelect</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;#vid-container-2&#39;</span><span style="color: #f8f8f2">).</span><span style="color: #a6e22e">position</span><span style="color: #f8f8f2">();</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">scrubTime</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">scrubTimeSelect</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">top</span>
    <span style="color: #a6e22e">vid</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">currentTime</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">eval(</span><span style="color: #a6e22e">totalTime</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;-&quot;</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">scrubTime</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">/</span><span style="color: #ae81ff">25</span><span style="color: #f8f8f2">;</span>
<span style="color: #f8f8f2">},</span> <span style="color: #ae81ff">40</span><span style="color: #f8f8f2">);</span>
</pre></div>




<p>I have included some comments to explain what each part of the code is doing. The setInterval function is one of the more powerful parts of this code. It finds how far the div containing the flower video has scrolled, does a calculation to inverse that number (so the flower goes from closed to open and not opened to close), and finally sets the current time of the video. It then repeats this code every 40ms. This allows for smooth playback experience. For clarity, the video is not actually &#8216;playing&#8217; during any point of this code. This code simply sets a new frame based on how far a user has scrolled and repeats this process very frequently.</p>




<p>To get this to work in a production environment, you will need to load the video file into a blob url so it can be stored in memory instead of sending get requests to a server every 40ms.</p>




<!-- HTML generated using hilite.me -->


<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span> <span style="color: #f8f8f2">document</span> <span style="color: #f8f8f2">).</span><span style="color: #a6e22e">ready</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>

  <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">xhr</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">XMLHttpRequest</span><span style="color: #f8f8f2">();</span>
  <span style="color: #a6e22e">xhr</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">open</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;GET&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;/images/flower-slow-bloom-4k.mp4&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">true</span><span style="color: #f8f8f2">);</span>
  <span style="color: #a6e22e">xhr</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">responseType</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;blob&#39;</span><span style="color: #f8f8f2">;</span>

  <span style="color: #a6e22e">xhr</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">onload</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">e</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">status</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">200</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #75715e">// Note: .response instead of .responseText</span>
      <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">blob</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">response</span><span style="color: #f8f8f2">;</span>
      <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">vid_url</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">URL</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">createObjectURL</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">blob</span><span style="color: #f8f8f2">);</span>
      <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;video&#39;</span><span style="color: #f8f8f2">).</span><span style="color: #a6e22e">attr</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;src&#39;</span><span style="color: #f8f8f2">,</span><span style="color: #a6e22e">vid_url</span><span style="color: #f8f8f2">)</span>
      <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">video</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">$</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;video&#39;</span><span style="color: #f8f8f2">);</span>
      <span style="color: #a6e22e">video</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">onload</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
        <span style="color: #66d9ef">debugger</span><span style="color: #f8f8f2">;</span>
        <span style="color: #a6e22e">URL</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">revokeObjectURL</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">vid_url</span><span style="color: #f8f8f2">)</span>
      <span style="color: #f8f8f2">}</span>
      <span style="color: #a6e22e">video</span><span style="color: #f8f8f2">[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">play</span><span style="color: #f8f8f2">()</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">};</span>

  <span style="color: #a6e22e">xhr</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">();</span>
    <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span> <span style="color: #e6db74">&quot;ready!&quot;</span> <span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>




<p>One thing to note is the video scroll can become laggy when a user has a lot of tabs open.</p>




<h2>What really excites me&#8230;</h2>


<p>&#8230;is other implementations of value input to control video playback. While a scroll is an interesting way of controlling the values passed to vid.currentTime, there are many other possbilities including physical devices, audio input, etc. Additionally, I&#8217;m interested in seeing how different video sources could be used instead of being constrained to one video stored locally. Find out more about this project at my <a href="https://github.com/jmeyers44/scrub-video-on-scroll" target="_blank">Github page</a> to stay up to date and, as always, feel free to contribute and submit a pull request!</p>




<script src="/javascripts/flower.js"></script>




	</section>

    </article>

  
    <article class="post">
      
	
	<header class="post-header">
		<span class="post-meta">12 May 2015</span>
		<h2 class="post-title">
			
			<a href="/blog/2015/05/12/need-for-speed-ruby-YARV-v-node-js/">
			
				Need for Speed: YARV v. Node</a>
		</h2>
	</header>
	<section class="post-excerpt">
		<p><p>On my first day learning javascript, I kept hearing / reading how much &lsquo;faster&rsquo; my javascript programs would run compared to the Ruby programs I was accustomed to. One of the main reasons for the increased speed is V8, <a href="https://developers.google.com/v8/" target="_blank">Google&rsquo;s open source high-performance JavaScript engine</a>. I decided the best way to put my new found knowledge to the test was to have a drag race. I decided to use the first <a href="https://projecteuler.net/problem=1" target="_blank">Project Euler</a> problem as my drag strip, and node.js and YARV as my race cars.
<br></p>

<p><h3>The Problem</h3></p>

<blockquote><p>If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23. Find the sum of all the multiples of 3 or 5 below 1000.</p></blockquote>

<p><br>
<h3>Code</h3>
<p>I wanted to make my Ruby code and Javascript code as similar as possible. Both solutions increment a count, test if it is divisible by 3 or 5, add the current count to a total if it is divisible and finally increment the count by 1. This process is repeated until the limit (in our case 1000) is reached.
<br>
<h5>Ruby</h5>
<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">require</span> <span style="color: #e6db74">&#39;benchmark&#39;</span>
<span style="color: #f8f8f2">total</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span>
<span style="color: #f8f8f2">execution_time</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Benchmark</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">realtime{</span><br/>
  <span style="color: #f8f8f2">x</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">3</span>
  <span style="color: #f8f8f2">until</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">&gt;=</span> <span style="color: #ae81ff">1000</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">3</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">5</span> <span style="color: #f92672">==</span> <span style="color: #ae81ff">0</span>
      <span style="color: #f8f8f2">total</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">x</span>
    <span style="color: #f8f8f2">end</span>
    <span style="color: #f8f8f2">x</span> <span style="color: #f92672">+=</span> <span style="color: #ae81ff">1</span>
  <span style="color: #f8f8f2">end}</span>
<span style="color: #f8f8f2">puts</span> <span style="color: #e6db74">&quot;The sum is #{total}&quot;</span>
<span style="color: #f8f8f2">puts</span> <span style="color: #e6db74">&quot;Execution Time: #{&quot;</span><span style="color: #f92672">%</span><span style="color: #ae81ff">1.12</span><span style="color: #f8f8f2">f</span><span style="color: #e6db74">&quot; % execution_time} seconds&quot;</span>
</pre></div></p>

<p><br>
<h5>Javascript</h5>
<div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">aTimer</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">process</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hrtime();</span>
<span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">sum</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">(var</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">&lt;</span> <span style="color: #ae81ff">1000</span> <span style="color: #f8f8f2">;</span> <span style="color: #f8f8f2">x</span><span style="color: #f92672">++</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
  <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(x</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">3</span> <span style="color: #f92672">===</span> <span style="color: #ae81ff">0</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">x</span> <span style="color: #f92672">%</span> <span style="color: #ae81ff">5</span> <span style="color: #f92672">===</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #f8f8f2">sum</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">x;</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">console</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">log(</span><span style="color: #e6db74">&#39;The sum of them is: &#39;</span><span style="color: #f92672">+</span> <span style="color: #f8f8f2">sum);</span>
<span style="color: #f8f8f2">var</span> <span style="color: #f8f8f2">aTimerDiff</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">process</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">hrtime(aTimer);</span>
<span style="color: #f8f8f2">console</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">info(</span><span style="color: #e6db74">&quot;Execution time: %dseconds&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">aTimerDiff[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">]</span><span style="color: #f92672">/</span><span style="color: #ae81ff">1000000000</span><span style="color: #f8f8f2">);</span>
</pre></div></p>

<p><br>
<h3>First Race: Limit => 1000</h3>
<div>
<img class="left" src="/images/ruby-first-race.png" width="700" title="image" alt="images">
</div>
<h3> V.</h3>
<div>
<img class="left" src="/images/js-first-race.png" width="700" title="image" alt="images">
</div>
<p>To my surprise, Ruby was faster&hellip;Much. Faster. Were all of the speed optimizations of Javascript an exageration? Had Ruby made Earth shattering speed improvements when it switched from MRI to YARV in Ruby 1.9? I needed another test, this time with a much larger calculation&hellip;</p>
<br>
<h3>Second Race: Limit => 100000000</h3>
<div>
<img class="left" src="/images/ruby-second-race.png" width="700" title="image" alt="images">
</div>
<h3> V.</h3>
<div>
<img class="left" src="/images/js-second-race.png" width="700" title="image" alt="images">
</div>
<h3>JAVASCRIPT WINS BY A LANDSLIDE!!!!</h3>
<br>
<p>I was fascinated by the results of these two tests. Even though they confirmed that Javascript is very fast, the tests uncovered an interesting interpreter behavior. My first guess as to why Ruby performs better on small calculations is start up time. Node may have a slower initialization time, which would lead to slower performance on small calculations, but improved performance on large calculations where the full wrath of V8 can be unleashed. I look forward to testing more Project Euler problems and taking a look under the hood of both node and YARV in the near future.</p></p>

<p><p><a href="https://github.com/jmeyers44/project-euler-js-v-ruby">Be sure to check out the github repo for this project and submit a pull request for your race.</a></p></p>

	</section>

    </article>

  
    <article class="post">
      
	
	<header class="post-header">
		<span class="post-meta">26 Apr 2015</span>
		<h2 class="post-title">
			
			<a href="/blog/2015/04/26/builder-beware-the-limitations-of-popular-apis/">
			
				Builder Beware: The Limitations of Popular APIs</a>
		</h2>
	</header>
	<section class="post-excerpt">
		<p><br></p>

<p>This post came about during the research process of a project I&#8217;m building that involves heavy use of some of the web&#8217;s most popular media services. YouTube, Instagram, Spotify and Soundcloud all have APIs, but have very different approaches to how they let developers access them. One of my biggest concerns of working with these APIs was not the data I could request, but how much I could request and how fast. This post breaks down the current API usage for each of the aforementioned services.</p>


<p><br></p>

<h3>YouTube:</h3>


<p></p>

<p>Application Limit: 50,000,000 units per day
or 30,000 units per user per second
This limit describes a global quota pool.
That means that any user or ip-address associated with a specific project will decrement the global quota pool.</p>

<blockquote><p>In v3, there is a global quota pool (of 50 million units/day), and all API calls that are associated with a specific project in the Developers Console decrement quota from that pool. Therefore, it is theoretically possible for a single IP address or channel to consume all of the quota associated with an API registration, which could lead to an outage that affects other users. <a href="https://developers.google.com/youtube/2.0/deprecation_faq" target="_blank">Source</a></p></blockquote>

<p>The following is a code example, which obtains one page of a users likes, would incur a quota cost of 3 units.</p>

<p><code>GET https://www.googleapis.com/youtube/v3/activities?part=snippet&amp;maxResults=50&amp;mine=true&amp;key={YOUR_API_KEY}</code></p>

<p>That means that every day a single project could get a maximum  of 833,333,335 likes from the YouTube API.<br/>
(50,000,000/3) = 16,666,666 page results
16,666,666 * 50 liked videos per page
=833,333,335 liked videos</p>

<p><em>The real number of likes a project could get from the API each day would be less as various users would not make requests at the optimal 50 results per page.</em></p>

<p>The take away from this section is that the YouTube API has given developers enough runway to onboard a meaningful amount of users before any quota limits are reached. Google has channels for developers to request additional limits as well, however that functionality seems to be temporarily suspended.</p>

<p><img src="/images/google_api.png" alt="google api notice" height="100%"width="100%"></p>

<h3>Instagram</h3>


<p>Instagram employs a different quota approach compared to Youtube by allowing a local quota pool for each authenticated user of 5,000 units per hour per token.</p>

<blockquote><p>We recommend that you use an Oauth token for the authenticated user for each endpoint, even in cases where it&rsquo;s not required, since the rate limit for authenticated calls scales as you grow the amount of people using your app. <a href="https://instagram.com/developer/limits/" target="_blank">Source</a></p></blockquote>

<p>Instagram usually returns between 21-23 liked photos per API call. The code below deprecates the hourly quota of 5,000 by 1.</p>

<p><code>GET/users/self/media/liked</code></p>

<p>Theoretically, a single user could call between 105,000 and 115,000 liked photos per hour. However, Instagram will return an error if the API is called too frequently. Stating</p>

<blockquote><p>Be nice. If you&rsquo;re sending too many requests too quickly, we&rsquo;ll send back a 503 error code (server unavailable).</p></blockquote>

<h3>Spotify</h3>


<p>Spotify does not have explicit rate limits defined in its API, however a few posts on their API forum yielded the following conversation with two Spotify developers.
<img src="/images/spotify_forum.png" alt="spotify developer forum" width="100%" height="100%"></p>

<p>In short, Spotify has vauge rate limits regarding their various endpoints. Authenitcated requests will have higher rate limits. However, all rate limits are on a per application basis.</p>

<h3>SoundCloud</h3>


<p>I could not find any information regarding the rate limits of the Soundcloud API.Their documentation did have this to say&hellip;</p>

<blockquote><p>We reserve the right, at our discretion, to impose restrictions and limitations on the number and frequency of calls made by your app to the SoundCloud® API. You must not attempt to circumvent any restrictions or limitations that we impose.</p></blockquote>

<h3>Are APIs Limitless&#8230;?

<img src="/images/limitless.gif" alt="limitless">

&#8230;not quite.</h3>




<p>I think a full understanding of rate limits is a pre-requisite for any developer interested in using an API. An API like Spotify can not be used to power an app that depends on individual user data as the rate limit will be hit before even 100 users are signed up. Conversley, the YouTube API, while still employing a per application rate limit, provides developers with enough runway to get significant traction and users. The most developer friendly API, out of the four discussed here is the Instagram API, as the rate limit scales linerally with every user onboarded. While there are many other factors to consider before integrating an API into one&#8217;s project, rate limits are a good place to start.</p>




	</section>

    </article>

  
    <article class="post">
      
	
	<header class="post-header">
		<span class="post-meta">26 Apr 2015</span>
		<h2 class="post-title">
			
			<a href="/blog/2015/04/26/databases-from-the-basics-to-facebook/">
			
				Databases: FROM the Basics to Facebook</a>
		</h2>
	</header>
	<section class="post-excerpt">
		<p>What is a database? If you had to guess would you say it&rsquo;s like a bunch of these&hellip;
<img src="/images/excel_sheet.png" alt="excel sheet">
<br>
&hellip;jammed into something that looks like this&hellip;
<br>
<br>
<img src="/images/Database_1.png" alt="database">
<br></p>

<p>..that makes a magical data vortex?</p>

<iframe src="//giphy.com/embed/v37chFjA54wHC?html5=true" width="600" height="360" frameBorder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>


<p><br>
<strong>Well</strong>&hellip;that&rsquo;s not quite right.</p>

<p>In this blog post we will take a look at the basic components of a database. As a beginner it is important to understand the fundamentals of databases, but it can also be helpful and even inspirational to see how some of the best minds and companies put these technologies to work.</p>

<h4>High Level Database Architecture</h4>


<p><strong>Databases</strong>: This is where you model your data. By and large, SQL based databases contain tables, indexes, views, stored procedures and triggers. This data is contained in a larger Database Management System(DBMS).</p>

<p><strong>Database Management System:</strong> A DBMS is a collection of programs that enables you to store, modify, and extract information from a database. In addition to your data, these typically include programs responsible for security, query processing, a storage engine and a data dictionary. Examples of DBMS Models are Flat file, Hierarchical, Network, Relational and Object-Oriented. The relational model is the most commonly used today.</p>

<p><strong>SQL</strong>
Structured Query Language (SQL) is a special purpose programming language designed for handling data in a relational database management system. SQL was created in the 1970s  and commercialized by Oracle. Today open source resources like MySQL, PostgreSQL, SQLite and Firebird have helped SQL become one of the most popular database resources. Go check out the <a href=http://en.wikipedia.org/wiki/Query_language type=_blank>34 other query languages</a> on Wikipedia.</p>

<p> <strong>NoSQL</strong>
NoSQL (or Not Only SQL) refers to a variety of database modeling techniques, including key-value, graph and document, that do not rely on tabular relations (data organized into rows and columns with a unique key for each row). It does not require fixed table schemas, avoids join operations by storing denormalized data, and are designed to scale horizontally.</p>

<p>Now that we have a little context, lets take a look at how one of the best technology companies in the world handles its data.</p>

<h2>Facebook</h2>


<p>Facebook delivers highly customized, real-time content to over 1 billion users. Various information types such as comments, likes, photos and videos must not only be served to their intended user, but must able to respond to spikes in requests should a specific piece of content go viral. To do this they use a highly customized version of MySQL. A conversation with two of Facebook&rsquo;s MySQL gurus details their thought process.</p>

<p>A <a href="http://www.percona.com/blog/2014/03/27/a-conversation-with-5-facebook-mysql-gurus/" target=_"blank">conversation</a> with FB engineers Yoshinori Matsunobu &amp; Mark Callaghan.</p>

<blockquote><p>Tom: Why MySQL? Wouldn’t NoSQL databases, for example, be better suited for the massive workloads seen at Facebook?</p>

<p>Mark: MySQL is great for many of our important workloads. We make it even better with our expertise in MySQL operations and engineering, and by working with the community and learning from their experience.</p>

<p>Yoshinori: I have not been able to find a transactional NoSQL database better than InnoDB. And it’s easy to understand how MySQL Replication works, which makes much easier to fix problems in production.</p></blockquote>

<p><strong>Using the Graph API</strong>
Facebook has a graph API (<a href="https://www.facebook.com/notes/facebook-engineering/tao-the-power-of-the-graph/10151525983993920" target="_blank">TAO</a>) that enables a user to access all of the social graph as if it were a large graph database. The power of a graph database is illustrated in the example from the FB API site below.</p>

<p>Here&rsquo;s an example query that will retrieve up to five albums created by someone, and the last five posts in their feed.</p>

<p><code>GET graph.facebook.com
  /me?
    fields=albums.limit(5),posts.limit(5)</code></p>

<p>We can then extend this a bit more and for each album object, also retrieve the first two photos, and people tagged in each photo:</p>

<p><code>GET graph.facebook.com
  /me?
    fields=albums.limit(5){name, photos.limit(2)},posts.limit(5)</code></p>

<p>Now we can extend it again by retrieving the name of each photo, the picture URL, and the people tagged:</p>

<p><code>GET graph.facebook.com
  /me?
    fields=albums.limit(5){name, photos.limit(2){name, picture, tags.limit(2)}},posts.limit(5)</code></p>

<p>You can see how field expansion can work across nodes, edges, and fields to return really complex data in a single request. <a href="https://developers.facebook.com/docs/graph-api/using-graph-api/v2.3" target="_blank">Source</a></p>

<p>I found the example above fascinating and illuminating. Up until this point I have only interacted with SQL and relied on joins to match data from one table to corresponding data in another table. The graph database provides an almost intuitive query flow to access information. Check out some of the resources below for more on how Facebook&rsquo;s engineers keep the world&rsquo;s largest social network up and running.</p>

<p><em>Additional Reading</em><br/>
Chip Turner, FB Engineering Manager <a href="http://www.percona.com/live/mysql-conference-2014/sites/default/files/slides/Percona%20Live%202014.pdf" type=_blank>DB Presentation</a>
<a href="https://www.facebook.com/notes/facebook-engineering/tao-the-power-of-the-graph/10151525983993920" type=_blank>TAO: The Power of the Graph</a></p>

<p><strong>BONUS GLOSSARY</strong></p>

<p><a href=http://en.wikipedia.org/wiki/ACID target="_blank"><strong>ACID</strong></a> (Atomicity, Consistency, Isolation, Durability): This acronym is a set of properties that can guarantee that database transactions are processed reliably. <strong>Atomicity</strong> refers to a database transaction where either all operations occur or none occur. This is critical to prevent partial database updates. <strong>Consistency</strong> refers to a set of defined ruls that any given database transaction must follow. While it does not mean that a transaction will be error free, it does mean that the error cannot be the result of a violation of defined rules. <strong>Isolation</strong> is a general measure of users ability to access data concurrently. <strong>Durability</strong> is the requirement that committed transactions will survive even in the event of a system crash.</p>

<p><em>NOTE: This was a very high level overview. If you have interest in diving into any of these topics some interesting subjects are <a href="http://en.wikipedia.org/wiki/Object-relational_impedance_mismatch" target_blank>Object-relational impedance mismatch</a>, <a href="http://en.wikipedia.org/wiki/Relational_model" target=_blank>The Relational Model</a> or any of the resources linked in the body of this post.</em></p>

	</section>

    </article>


<nav class="pagination" role="pagination">
  

  <span class="page-number">
    Page 1 of 1
  </span>

  
</nav>


  </main>
  <footer class="site-footer"><a class="subscribe icon-feed" href="http://jmeyers44.github.io/atom.xml"><span class="tooltip">Subscribe!</span></a>


<div class="inner">









<section class="copyright">All content copyright <a href="/">Jonathan Meyers</a> © 2015 • All rights reserved.</section>

<section class="poweredby">Casper theme by <a class="icon-ghost" href="http://tryghost.org">Ghost</a> &amp; Published with <a href="http://octopress.org">Octopress</a></section>

</div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>






</body>
</html>
